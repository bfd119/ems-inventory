# メール自動送信システム セットアップ手順

Google Apps Script (GAS) を使用して、期限切れ在庫のリマインドメールを自動送信するための設定手順です。

## 1. Google Apps Script プロジェクトの作成

1. Googleドライブ (https://drive.google.com/) を開き、メール送信を行いたいGoogleアカウント (`bfdsyoubara119@gmail.com`) でログインしてください。
2. 左上の「＋ 新規」ボタンをクリックし、「その他」 > 「Google Apps Script」を選択します。
   - もしメニューにない場合は、「アプリを追加」から「Google Apps Script」を検索してインストールしてください。
3. 新しいタブが開いたら、左上の「無題のプロジェクト」をクリックし、「在庫管理リマインダー」など分かりやすい名前に変更します。

## 2. スクリプトの記述

1. エディタ画面（`コード.gs` というファイルが開いていると思います）にある既存のコード（`function myFunction() {...}`）を全て削除します。
2. デスクトップ上に保存された `mail_sender.js` の中身を全てコピーし、GASのエディタに貼り付けます。
3. フロッピーアイコン（保存）をクリックするか、`Ctrl + S` を押して保存します。

## 3. テスト実行と権限承認（重要）

1. 上部のツールバーで、実行する関数が `sendReminderEmails` になっていることを確認します（なっていなければプルダウンから選択）。
2. 「実行」ボタンをクリックします。
3. 初回のみ、「権限を確認」というポップアップが表示されます。
   - 「権限を確認」をクリック。
   - アカウントを選択。
   - 「このアプリはGoogleによって確認されていません」と出た場合：
     - 左下の「詳細」をクリック。
     - 「在庫管理リマインダー（安全ではないページ）に移動」をクリック。
   - 「許可」をクリックしてアクセス権を与えます。
4. 実行ログに「処理開始...」などが表示され、エラーが出なければ成功です。
   - もし今月が期限の在庫があれば、実際に対象のアドレスへメールが送信されます。テスト時は必要に応じて `EMAIL_LIST` 内のアドレスをご自身のものに書き換えて試すことをお勧めします。

## 4. 自動実行（トリガー）の設定

毎月1日と末日に自動で実行されるように設定します。

1. GAS画面の左側メニューから目覚まし時計アイコン（トリガー）をクリックします。
2. 右下の「トリガーを追加」をクリックします。
3. **トリガーの追加**:
   - 右下の「トリガーを追加」ボタンをクリックします。
   - 以下の設定でトリガーを作成します（計2つ作成します）：
     
     **トリガー1（月初）**:
     - 実行する関数: `sendReminderEmails`
     - イベントのソース: `時間主導型`
     - トリガーのタイプ: `月ベースのタイマー`
     - 日を選択: `1日`
     - 時刻を選択: `午前 9時 ～ 10時` (または任意の時間)

     **トリガー2（25日）**:
     - 実行する関数: `sendReminderEmails`
     - イベントのソース: `時間主導型`
     - トリガーのタイプ: `月ベースのタイマー`
     - 日を選択: `25日`
     - 時刻を選択: `午前 9時 ～ 10時` (または任意の時間)

   - 「保存」をクリックします。

**末日の設定について:**
GASの標準機能では「月末」という指定ができません。
代替案として、「毎月1日」に実行し、スクリプト内で「前月の月末期限のもの」を確認するか、あるいは「日付ベースのタイマー」で「30日」や「31日」を複数設定する方法がありますが、一番確実なのは**「毎月1日」のトリガーで「今月期限のもの」を通知する**設定です（現状のコードはこの仕様です）。
もし「月末」にも念押しで送りたい場合は、同様に「25日」などに設定を追加してください。

## 5. 運用上の注意

- **送信元アドレス**: GASを実行したGoogleアカウント (`bfdsyoubara119@gmail.com`) が送信元 (`From`) になります。
- **送信件数制限**: 一般的なGmailアカウントの場合、1日あたり100通程度が上限です。今回の用途（署所数11箇所 × 月2回）では問題ありません。
